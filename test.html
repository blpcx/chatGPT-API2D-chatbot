
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>chatGPT v3</title>
  <style>
    body {
        background-color: #f0f0f0;
        font-family: 'Arial', sans-serif;
    }

    .container {
        width: 1000px;
        height: 690px;
        margin: 0 auto;
        padding-top: 10px;
        padding-bottom: 0px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0px 0px 10px #bbb;
        /* 将主轴方向设为从下到上 */
        display: flex;
        flex-direction: column-reverse; 
    }

    .input {
      width: 98.5%;
      margin-bottom: 5px;
      padding: 5px;
      font-size: 16px;
      border: 1.5px solid rgb(177, 180, 246);
      border-radius: 10px;
      outline: 3px solid rgb(144, 149, 255);
      outline-offset: -1px;
    }

    .output {
      height: 90%;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 16px;
      overflow-y: scroll;
      scrollbar-width: thin;
      border: 1.5px solid rgb(177, 180, 246);
      border-radius: 10px;
      outline: 3px solid rgb(1, 255, 200);
      outline-offset: -1px;
      /* 将主轴方向设为从上到下 */
      display: flex;
      flex-direction: column;
    }

    .user {
      /* margin-right: 0px; */
      margin-top: 15px;
      color: rgb(16, 110, 6);
      /* 设置颜色 */
      /* align-self: flex-end; */
    }

    .bot {
      /* margin-right: 20px; */
      margin-top: 15px;
      color: rgb(0, 13, 255);
      /* 设置颜色 */
      /* align-self: flex-start; */
    }

    .user-message {
      font-family: 'Arial';
      color: rgb(16, 110, 6);
      background-color: rgba(152, 251, 152, 0.3);
      border-radius: 10px;
      margin-top: 5px;
      margin-bottom: 5px;
      /* margin-right: 20px; */
      /* align-self: flex-end;  */
      white-space: pre-wrap;
    }

    .bot-message {
      font-family: 'Arial';
      color: rgb(0, 13, 255);
      background-color: rgba(135, 206, 250, 0.5);
      border-radius: 10px;
      margin-top: 5px;
      margin-bottom: 5px;
      /* margin-left: 20px; */
      /* align-self: flex-start; 右对齐 */
      white-space: pre-wrap;
    }

    .form-container {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        width: 100%;
        position: relative;
        font-family: 'Arial';
        font-size: 16px;
    }

    #balance {
        font-family: 'Arial';
        font-size: 16px;
        text-align: center;
        border: 1.5px solid rgb(0, 164, 28);
        border-radius: 10px;
        color:rgb(0, 168, 98)
    }

    button {
        width: 5%;
        color: rgb(48, 139, 6);
        border: none;
        border-radius: 10px;
        font-family: 'Arial';
        font-size: 16px;
        margin-left: 10px;
    }
    button:hover {
        cursor: pointer;
    }
    button:focus {
        outline: none;
    }

  </style>
</head>

<body>
  <div class="container">
    <input class="input" id="inputBox" type="text" placeholder="输入你的问题，enter键确认发送……">
    <div class="output" id="outputBox"></div>
    <form>
      <button type="button" onclick="fetchBalance()"><strong>余额</strong></button>
      <input type="text" id="balance" name="balance" readonly><br><br>
    </form>
  </div>

  <script>
    // JavaScript代码
    const apiUrl = "https://openai.api2d.net/v1/chat/completions";
    const KEY='forward key';
    const headers = {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${KEY}`
    };
    let sessionId = null;
    const inputBox = document.getElementById("inputBox");
    const outputBox = document.getElementById("outputBox");
    function sendMessage(message) {
      let data = {
        "model": "gpt-3.5-turbo-0301",
        "messages": [{ "role": "user", "content": message }],
        "temperature": 0.5,
      };
      if (sessionId !== null) {
        data.session_id = sessionId;
      }
      return fetch(apiUrl, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify(data)
      }).then(response => response.json()).then(result => {
        console.log(result);
        sessionId = result.session_id;
        return result.choices[0].message.content.trim();
      });
    }
    function sendMsg() {
      let message = inputBox.value;
      if (message === '') {
        return;
      }

      let messageDiv = document.createElement('div');
      messageDiv.className = 'user';
      messageDiv.textContent = '我：';
      outputBox.appendChild(messageDiv);

      let messageContent = document.createElement('div');
      messageContent.className = 'user-message';
      messageContent.textContent = message;
      messageDiv.appendChild(messageContent);

      let responseDiv = document.createElement('div');
      responseDiv.className = 'bot';
      responseDiv.textContent = 'gpt-3.5-turbo-0301：';
      outputBox.appendChild(responseDiv);

      sendMessage(message).then(response => {
        let responseContent = document.createElement('div');
        responseContent.className = 'bot-message';
        responseContent.textContent = response;
        responseDiv.appendChild(responseContent);

        // 自动滚动输出框
        outputBox.scrollTop = outputBox.scrollHeight;
      }).catch(error => {
        console.error(error);
      });

      inputBox.value = '';
    }

    inputBox.addEventListener("keyup", function (event) {
      if (event.keyCode === 13) {
        if (inputBox.value.trim() !== "") {
          sendMsg();
        }
      }
    });
    function fetchBalance() {
			// 添加 AJAX 请求
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "https://openai.api2d.net/dashboard/billing/credit_grants");
			xhr.setRequestHeader("Content-Type", "application/json");
			xhr.setRequestHeader("Authorization", `Bearer ${KEY}`);
			xhr.onreadystatechange = function() {
				if (this.readyState === 4 && this.status === 200) {
					// 更新显示余额的文本框
					const response = JSON.parse(this.responseText);
					const balance = response.total_available;
					document.getElementById("balance").value = balance;
				}
			};
			xhr.send();
		}
  </script>
</body>

</html>
